# for running tox with travis there is no straight forward solution, see:
# https://docs.travis-ci.com/user/languages/python/#using-tox-as-the-build-script
# therefore running tests and coverage is done manually for travis
language: python

jobs:
    include:
        - name: "setup python 3.7.3"
          language: python
          python: "3.7.3"
          install: 
            - pip install -U six # six is not up to date in travis image
            - make install-dev

script:
    - coverage run --source=src/camguard -m unittest -v
    #- coverage report -m

# Report results to DeepSource
after_success:
  # Generate coverage report in xml format
  - coverage xml

  # Install deepsource CLI
  - curl https://deepsource.io/cli | sh

  # Report coverage artifact to 'test-coverage' analyzer
  - ./bin/deepsource report --analyzer test-coverage --key python --value-file ./coverage.xml
